@model MedProSC.Feature.ManualForms.Models.BuilderTable

<style>
    .dataTables_wrapper .dataTables_info,
    .dataTables_wrapper .dataTables_paginate {
        float: none;
        text-align: left;
        width: 50%
    }

    .dataTables_length {
        float: left;
        text-align: left;
    }
</style>

@if (Model != null)
{
    <div class="container mt-4">
        <table id="datatable" class="display" style="width:100%">
            <thead>
                <tr>
                    <th>@Model.FormNumber</th>
                    <th>@Model.FormName</th>
                    <th>@Model.Occurences</th>
                    <th>@Model.ClaimsMade</th>
                    <th>@Model.EffectiveDate</th>
                    <th>@Model.ExpirationDate</th>
                    @*<th style="width: 40px !important"></th>*@
                    </tr>
            </thead>
        </table>
    </div>

    @*<table id="loadtable" class="table table-bordered table-lg mytable">
            <thead class="builder-table-head">
                <tr>
                    <th>@Model.FormNumber</th>
                    <th class="w-50"> @Model.FormName</th>
                    <th> @Model.Occurences</th>
                    <th>@Model.ClaimsMade</th>
                    <th>@Model.EffectiveDate</th>
                    <th> @Model.ExpirationDate</th>
                    <th style="width: 40px !important"> </th>
                </tr>
            </thead>
            <tbody class="form-tablebody">
            </tbody>
            <tfoot>
                <tr>
                    <th colspan="2" class="footer-icons">
                        <i class="bi bi-skip-start-fill goto-first-last"></i>
                        <i class="bi bi-caret-left-fill left-right"></i>
                        @Html.Raw(Model.ShowPageNumber)
                        <i class="bi bi-caret-right-fill left-right"></i>
                        <i class="bi bi-skip-end-fill goto-first-last"></i>
                    </th>
                    <th colspan="4" class="reslt-page" style="text-align: right !important">
                        <span style="font-size: 13px">@Model.ResultsPerPage</span>&nbsp;&nbsp;
                        <select name="" id="results" class="result-count">
                            @foreach (var page in Model.PageNumbers)
                            {
                                <option value="@page.Name">@page.Name</option>
                            }
                        </select>
                    </th>
                    <th style="border: none !important"></th>
                </tr>
            </tfoot>
        </table>*@
}

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>

<script>

    $(document).ready(function () {

        $('.btn-load-form').on('click', function () {
            var IssueCompany = $('#formissue :selected').text();
            var State = $('#formstate :selected').text();
            var formDate = $('.formdate').val();
            var formType = $('.formstype :selected').text();
            var apiQueryString = "?issueCompany=" + IssueCompany + "&state=" + State + "&effectiveDate=" + formDate + "&formType=" + formType;

            var loadFormSearchModel = {
                issueCompany: IssueCompany,
                state: State,
                formDate: formDate, 
                formType: formType,
                apiQueryString: apiQueryString
            }
            $.ajax({
                type: "POST",
                url: "/manualformsapi/getloadforms",
                dataType: "json",
                data: { SearchModel: loadFormSearchModel },
                success: OnSuccess,
                failure: function (response) {
                    alert(response.d);
                },
                error: function (response) {
                    alert(response.d);
                }
            });
        });



        function OnSuccess(json) {
            var data = json.forms.map(data => {
                console.log(data);
                if (data.coverageTrigger == 'ALL') {
                    return [data.formNumber, data.formName, true, true, data.effectiveDate, data.expirationDate];
                }
                if (data.coverageTrigger == 'Occurrence') {
                    return [data.formNumber, data.formName, true, false, data.effectiveDate, data.expirationDate];
                }
                if (data.coverageTrigger == 'Claims Made') {
                    return [data.formNumber, data.formName, false, true, data.effectiveDate, data.expirationDate];
                }
            });

            var table = $('#datatable').DataTable({
                data: data,
                pageLength: 5,
                lengthMenu: [5, 10, 25, 50, 75, 100],
                columnDefs: [
                    { "width": "15%", "targets": 0 },
                    { "width": "45%", "targets": 1 },
                    {
                        "width": "10%",
                        "targets": 2,
                        "render": function (data, type, full, meta) {
                            return data ? '<input type="checkbox" disabled checked/>' : '<input type="checkbox" disabled/>'
                        }
                    },
                    {
                        "width": "10%",
                        "targets": 3,
                        "render": function (data, type, full, meta) {
                            return data ? '<input type="checkbox" disabled checked/>' : '<input type="checkbox" disabled/>'
                        }
                    },
                    { "width": "10%", "targets": 4 },
                    { "width": "10%", "targets": 5 },
                    /*  { "width": "5%", "targets": 6 }*/
                ],
                pagingType: "full",
                language: {
                    "info": "_START_ of _TOTAL_",
                    "paginate": {
                        "first": "<<",
                        "last": ">>",
                        "next": ">",
                        "previous": "<"
                    }
                },
                initComplete: function () {
                    tabulate(this.api().page.info());
                },
                dom: "<<t>pl>",
                "success": fnsuccesscallback,
                "error": fnerrorcallback

            });

            table.on('draw', function () {
                tabulate(table.page.info());
            });

            function fnsuccesscallback(data) {
                alert(data.d);
            }
            function fnerrorcallback(result) {
                alert("Error");
            }
        }
    });


    function tabulate(pageInfo) {
        var curr = pageInfo.page + 1;
        var tot = pageInfo.pages;
        $("<span>Page " + curr + " of " + tot + "</span>").insertAfter("a.paginate_button.previous");
    }
</script>