<?xml version="1.0" encoding="utf-8"?>
<configuration xmlns:patch="http://www.sitecore.net/xmlconfig/" xmlns:role="http://www.sitecore.net/xmlconfig/role/">
	<sitecore role:require="Standalone or ContentDelivery">
		<pipelines>
			<owin.identityProviders>
				<processor type="MedProSC.Foundation.Security.Pipelines.OktaIdentityProvider, MedProSC.Foundation.Security" resolve="true" >
					<!--<authority>https://dev-11646033.okta.com/</authority>
					<clientid>0oabjfyiiti7nogQI5d7</clientid>
					<clientsecret>drP8NKlRe_u-dC3iTmkvpJJnM9_6ohd_lV-MGCfMIeDH6NpvRUKU2dhKqk6XTAU</clientsecret>
					<OAuthRedirectUri>https://manualforms.dev.medro.com/identity/externallogincallback</OAuthRedirectUri>-->

					<!--MEDPRO-->
					<authority>https://medpro-admin.oktapreview.com</authority>
					<clientid>0oa1t4j3xrr8ycbDj0h8</clientid>
					<clientsecret>IMO-oyda7GTNuDJloSNsn3yQdGmIyY0jv6hzFlcNQNy1vDbfBM61vAo6VqJ5XhcD</clientsecret>
					<OAuthRedirectUri>https://manualforms.dev.medpro.com/identity/externallogincallback</OAuthRedirectUri>
					
					<!--<authority>https://dev-28083082-admin.okta.com/</authority>
					<clientid>0oab2ehfj607xs93E5d7</clientid>
					<clientsecret>MzBzcq3ROqOf7ODtcr0Z979OsLuiR9F2nskbykEGczM6B33-kUwUqLuKo59vYDvg</clientsecret>
					<OAuthRedirectUri>https://manualforms.dev.medpro.com/identity/externallogincallback</OAuthRedirectUri>-->
				</processor>
			</owin.identityProviders>
		</pipelines>
		<federatedAuthentication type="Sitecore.Owin.Authentication.Configuration.FederatedAuthenticationConfiguration, Sitecore.Owin.Authentication">
			<identityProvidersPerSites hint="list:AddIdentityProvidersPerSites">
				<mapEntry name="OktaTest" type="Sitecore.Owin.Authentication.Collections.IdentityProvidersPerSitesMapEntry, Sitecore.Owin.Authentication" resolve="true">
					<sites hint="list">
						<site>ManualForms</site>
					</sites>

					<identityProviders hint="list:AddIdentityProvider">
						<identityProvider ref="federatedAuthentication/identityProviders/identityProvider[@id='Okta']" />
					</identityProviders>

					<externalUserBuilder type="MedProSC.Foundation.Security.ExternalUserBuilder, MedProSC.Foundation.Security" resolve="true">
						<param desc="isPersistentUser">true</param>
					</externalUserBuilder>
				</mapEntry>
			</identityProvidersPerSites>


			<identityProviders hint="list:AddIdentityProvider">
				<identityProvider id="Okta" type="Sitecore.Owin.Authentication.Configuration.DefaultIdentityProvider, Sitecore.Owin.Authentication" >
					<param desc="name">$(id)</param>
					<param desc="domainManager" type="Sitecore.Abstractions.BaseDomainManager" resolve="true" />
					<caption>Log in with Okta</caption>
					<icon>/assets/okta.png</icon>
					<domain>sitecore</domain>
					<transformations hint="list:AddTransformation">
						<transformation name="nameidentifier" type="Sitecore.Owin.Authentication.Services.DefaultTransformation,Sitecore.Owin.Authentication">
							<sources hint="raw:AddSource">
								<claim name="email" />
							</sources>
							<targets hint="raw:AddTarget">
								<claim name="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier" />
							</targets>
							<keepSource>true</keepSource>
						</transformation>
						<transformation name="emailaddress" type="Sitecore.Owin.Authentication.Services.DefaultTransformation,Sitecore.Owin.Authentication">
							<sources hint="raw:AddSource">
								<claim name="email" />
							</sources>
							<targets hint="raw:AddTarget">
								<claim name="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress" />
							</targets>
							<keepSource>true</keepSource>
						</transformation>
						<transformation name="name" type="Sitecore.Owin.Authentication.Services.DefaultTransformation,Sitecore.Owin.Authentication">
							<sources hint="raw:AddSource">
								<claim name="name" />
							</sources>
							<targets hint="raw:AddTarget">
								<claim name="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name" />
							</targets>
							<keepSource>true</keepSource>
						</transformation>
						<transformation name="role or long role" type="Sitecore.Owin.Authentication.Services.DefaultTransformation,Sitecore.Owin.Authentication">
							<sources hint="raw:AddSource">
								<claim name="role" />
							</sources>
							<targets hint="raw:AddTarget">
								<claim name="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/role" />
							</targets>
							<keepSource>false</keepSource>
						</transformation>
						<transformation name="idpmap" type="Sitecore.Owin.Authentication.Services.DefaultTransformation,Sitecore.Owin.Authentication">
							<sources hint="raw:AddSource">
								<claim name="idp" />
							</sources>
							<targets hint="raw:AddTarget">
								<claim name="http://www.sitecore.net/identity/claims/shadowuser" />
							</targets>
							<keepSource>true</keepSource>
						</transformation>
						<transformation name="cookieexp" type="Sitecore.Owin.Authentication.Services.DefaultTransformation,Sitecore.Owin.Authentication">
							<sources hint="raw:AddSource">
								<claim name="exp" />
							</sources>
							<targets hint="raw:AddTarget">
								<claim name="http://www.sitecore.net/identity/claims/cookieExp" />
							</targets>
							<keepSource>true</keepSource>
						</transformation>
					</transformations>
				</identityProvider>
			</identityProviders>
			<propertyInitializer type="Sitecore.Owin.Authentication.Services.PropertyInitializer, Sitecore.Owin.Authentication" resolve="true">
				<maps hint="list">
					<map name="comment claim" type="Sitecore.Owin.Authentication.Services.DefaultClaimToPropertyMapper, Sitecore.Owin.Authentication" resolve="true">
						<data hint="raw:AddData">
							<source name="idp" />
							<target name="Comment" />
						</data>
					</map>
					<map name="name claim" type="Sitecore.Owin.Authentication.Services.DefaultClaimToPropertyMapper, Sitecore.Owin.Authentication" resolve="true">
						<data hint="raw:AddData">
							<source name="name" />
							<target name="FirstName" />
						</data>
					</map>
				</maps>
			</propertyInitializer>
		</federatedAuthentication>
	</sitecore>
</configuration>